@startuml faturacaopagamentos
autonumber
title Processo de Faturação e Pagamentos - CarXpress

actor Cliente
participant "Sistema" as UI
participant "Base de Dados" as DB
participant "Classe Fatura" as Fatura
participant "Classe Pagamento" as Pagamento
participant "Classe Recibo" as Recibo

Cliente -> UI : consultarFatura(IDFatura)
UI -> DB : recuperarDetalhesFatura(IDFatura)
DB -> UI : retornarFatura(Valor, Status)
UI -> Cliente : exibirFatura(Valor, Status)

Cliente -> UI : efetuarPagamento(IDFatura, MetodoPagamento)
UI -> Pagamento : processarPagamento(IDFatura, MetodoPagamento, Valor)
Pagamento -> DB : armazenarPagamento(IDPagamento)

alt Pagamento bem-sucedido
    UI -> Fatura : atualizarStatus(IDFatura, "Paga")
    Fatura -> DB : armazenarAtualizacao(IDFatura)
    
    UI -> Recibo : gerarRecibo(IDFatura, Data, Valor)
    Recibo -> DB : armazenarRecibo(IDRecibo)
    
    UI -> Cliente : confirmarPagamento(IDFatura, IDRecibo)
else Pagamento falhou
    UI -> Cliente : notificarFalhaPagamento()
    Cliente -> UI : tentarNovamente(IDFatura, NovoMetodoPagamento)
    UI -> Pagamento : processarPagamento(IDFatura, NovoMetodoPagamento, Valor)
end alt

@enduml
